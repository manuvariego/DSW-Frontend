@if (currentSection == 'initial') {
<div class="fade-in-anim">
  <!-- ALERTA DE CREACIÓN EXITOSA -->
  <div *ngIf="parkingCreado" class="alert alert-success-spaces shadow-sm text-center mb-4">
    <i class="fas fa-check-circle me-2"></i> Espacio creado exitosamente.
  </div>

  <div class="container mt-4">
    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4 spaces-header">
      <div>
        <h2 class="section-title mb-1">Gestionar mis Espacios</h2>
        <p class="spaces-subtitle mb-0">
          Administrá los espacios de estacionamiento disponibles en tu cochera.
        </p>
      </div>
      <button class="btn btn-outline-dark" routerLink="/garages">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </button>
    </div>

    <!-- MENÚ DE OPCIONES -->
    <div class="row justify-content-center">
      <div class="col-md-4 mb-4">
        <div class="card menu-card h-100 text-center p-4" (click)="showSection('getParkingSpace')">
          <div class="icon-container mb-3">
            <i class="fas fa-parking fa-3x"></i>
          </div>
          <h5 class="card-title">Ver espacios</h5>
          <p class="text-muted small">Consultá el listado de espacios creados. Podés editar y eliminar. </p>
          <button class="btn btn-dark-custom mt-2">
            Ver listado
          </button>
        </div>
      </div>

      <div class="col-md-4 mb-4">
        <div class="card menu-card h-100 text-center p-4" (click)="showSection('createMultipleParkingSpaces')">
          <div class="icon-container mb-3">
            <i class="fas fa-layer-group fa-3x"></i>
          </div>
          <h5 class="card-title">Crear</h5>
          <p class="text-muted small">
            Generá uno o varios espacios de estacionamiento de forma automática.
          </p>
          <button class="btn btn-dark-custom mt-2">
            Crear
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
}


@if (currentSection == 'getParkingSpace') {
<div class="container mt-4 fade-in-anim">
  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-3 spaces-header">
    <div>
      <h3 class="section-title mb-1">Espacios creados</h3>
      <p class="spaces-subtitle mb-0">
        Seleccioná un espacio para ver sus detalles, editarlo o eliminarlo.
      </p>
    </div>
    <button type="button" class="btn btn-outline-dark" (click)="showSection('initial'); selectedSpace = null">
      <i class="fas fa-arrow-left"></i> Volver
    </button>
  </div>

  <!-- GRILLA DE ESPACIOS -->
  <div *ngIf="parkingSpaceList.length > 0" class="card-box p-4 mb-4">
    <div class="d-flex flex-wrap gap-2">
      <button *ngFor="let space of parkingSpaceList" type="button"
        class="btn btn-sm space-view-btn"
        [class.space-selected]="selectedSpace?.number === space.number"
        (click)="selectSpace(space)">
        {{ space.number }}
      </button>
    </div>
  </div>

  <!-- MENSAJE VACÍO -->
  <div *ngIf="parkingSpaceList.length === 0" class="card-box p-4 text-center text-muted">
    <i class="fas fa-folder-open fa-2x mb-2 d-block"></i>
    <strong>No hay espacios registrados todavía.</strong>
    <br><em>Volvé al menú anterior y seleccioná "Crear" para generar tus espacios de estacionamiento.</em>
  </div>

  <!-- PANEL DE DETALLE DEL ESPACIO SELECCIONADO -->
  <div *ngIf="selectedSpace" class="card-box p-4 detail-panel fade-in-anim">
    <h5 class="fw-bold mb-3">
      <i class="fas fa-parking me-2"></i> Espacio #{{ selectedSpace.number }}
    </h5>
    <div class="mb-3">
      <span class="text-muted">Tipo de vehículo:</span>
      <p class="fw-bold mb-0">{{ selectedSpace.TypeVehicle?.name || 'Sin tipo asignado' }}</p>
    </div>
    <div *ngIf="isSpaceBlocked(selectedSpace.number)" class="alert alert-warning py-2 mb-3">
      <i class="fas fa-exclamation-triangle me-1"></i> Este espacio tiene reservas asociadas y no se puede eliminar.
    </div>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-dark-custom btn-sm"
        (click)="selectParkingSpaceToEdit(selectedSpace)">
        <i class="fas fa-pen me-1"></i> Editar
      </button>
      <button type="button" class="btn btn-outline-danger btn-sm"
        [disabled]="isSpaceBlocked(selectedSpace.number)"
        [title]="isSpaceBlocked(selectedSpace.number) ? 'No se puede eliminar un espacio con reservas asociadas' : 'Eliminar'"
        (click)="deleteParkingSpace(selectedSpace.number)">
        <i class="fas fa-trash-alt me-1"></i> Eliminar
      </button>
    </div>
  </div>
</div>
}


@if (currentSection == 'createMultipleParkingSpaces') {
<div class="container mt-4 fade-in-anim">
  <div class="row justify-content-center">
    <div class="col-md-8">

      <div class="card card-box shadow-lg">
        <div class="card-body">
          <h3 class="section-title mb-2 text-center">Crear espacios</h3>
          <p class="text-muted text-center mb-4">
            Generá uno o varios espacios de estacionamiento seleccionando sus números en la grilla.
          </p>

          <!-- Mostrar hasta -->
          <div class="mb-3">
            <label for="gridMaxNumber" class="form-label">Mostrar hasta el número</label>
            <input type="number" class="form-control modern-input" id="gridMaxNumber" [(ngModel)]="gridMaxNumber"
              min="1" />
          </div>

          <!-- Tipo de vehículo -->
          <div class="mb-3">
            <label for="multipleTypeVehicle" class="form-label">Tipo de vehículo</label>
            <select id="multipleTypeVehicle" class="form-select modern-input" [(ngModel)]="vehicleTypeId">
              <option value="" disabled>Seleccioná un tipo</option>
              <option *ngFor="let type of typeVehicles" [value]="type.id">
                {{ type.name }}
              </option>
            </select>
          </div>

          <!-- Grilla de números -->
          <label class="form-label mb-2">Seleccioná los espacios a crear</label>
          <div class="d-flex flex-wrap gap-2 mb-3">
            <button *ngFor="let num of getGridNumbers()" type="button" class="btn btn-sm space-grid-btn"
              style="width: 48px; height: 40px;" [class.btn-secondary]="isSpaceExisting(num)"
              [class.btn-outline-dark]="!isSpaceExisting(num) && !isSpaceSelected(num)"
              [class.btn-success]="isSpaceSelected(num)" [disabled]="isSpaceExisting(num)"
              (click)="toggleSpaceSelection(num)">
              {{ num }}
            </button>
          </div>

          <!-- Leyenda -->
          <div class="d-flex flex-wrap gap-3 mb-3 grid-legend">
            <small class="d-flex align-items-center gap-1">
              <span class="legend-dot bg-selected"></span> Seleccionado
            </small>
            <small class="d-flex align-items-center gap-1">
              <span class="legend-dot bg-secondary"></span> Ya existente
            </small>
            <small class="d-flex align-items-center gap-1">
              <span class="legend-dot border border-dark"></span> Disponible
            </small>
          </div>

          <!-- Resumen -->
          <div *ngIf="selectedSpaces.length > 0" class="alert alert-info mb-4">
            <strong>{{ selectedSpaces.length }}</strong> espacio(s) seleccionado(s).
          </div>

          <!-- Botones -->
          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-outline-secondary" (click)="showSection('initial')">
              <i class="fas fa-arrow-left"></i> Volver
            </button>

            <button type="button" class="btn btn-dark-custom" [disabled]="selectedSpaces.length === 0 || !vehicleTypeId"
              (click)="createMultipleParkingSpaces()">
              <i class="fas fa-layer-group me-1"></i> Crear espacios
            </button>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
}


@if (currentSection == 'selectParkingSpaceToEdit') {
<div class="container mt-5 fade-in-anim">
  <div class="card-box p-5 mx-auto" style="max-width: 600px;">
    <h3 class="text-center mb-2 section-title">Modificar espacio</h3>
    <p class="text-muted text-center mb-4">
      Actualizá el tipo de vehículo permitido para este espacio.
    </p>

    <form (ngSubmit)="updateParkingSpace(parkingSpaceForm)" #parkingSpaceForm="ngForm" class="needs-validation"
      novalidate>

      <div class="row">

        <div class="col-md-6 form-group mb-3">
          <label for="number" class="form-label">Número</label>
          <input type="text" class="form-control modern-input" id="number" name="number"
            [(ngModel)]="editingParkingSpace.number" readonly/>
        </div>

        <div class="col-md-6 form-group mb-3">
          <label for="garage" class="form-label">Garage (CUIT)</label>
          <input type="text" class="form-control modern-input bg-light" id="garage" name="garage"
            [(ngModel)]="editingParkingSpace.garage" readonly />
        </div>
      </div>

      <div class="form-group mb-4">
        <label for="TypeVehicle" class="form-label">Tipo de vehículo</label>
        <select class="form-select modern-input" id="TypeVehicle" name="TypeVehicle"
          [(ngModel)]="editingParkingSpace.TypeVehicle" #TypeVehicle="ngModel" required
          [class.is-invalid]="TypeVehicle.invalid && (TypeVehicle.dirty || TypeVehicle.touched)">
          <option *ngFor="let typeVehicle of typeVehicles" [value]="typeVehicle.id">
            {{ typeVehicle.name }}
          </option>
        </select>
        <div class="invalid-feedback">Seleccione un tipo.</div>
      </div>

      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-dark-custom btn-block">
          Guardar cambios
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="showSection('initial')">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
}