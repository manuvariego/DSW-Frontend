<div *ngIf="message" class="toast-message shadow-sm"
  [ngClass]="messageType === 'success' ? 'toast-success' : 'toast-error'">
  <i class="fas me-2" [ngClass]="messageType === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'"></i>
  {{ message }}
</div>

<div class="container mt-5 fade-in-anim">
  <div class="card-box p-5 mx-auto" style="max-width: 600px;">

    <!-- SELECCIÓN DE TIPO DE CUENTA -->
    <div *ngIf="currentStep === 'selectType'">
      <div class="text-center mb-4">
        <h2 class="section-title">Crear cuenta</h2>
        <p class="text-muted">Seleccioná el tipo de cuenta que querés crear.</p>
      </div>

      <div class="row g-3">
        <div class="col-md-6">
          <div class="card h-100 text-center p-4 account-type-card" (click)="selectAccountType('user')"
            style="cursor: pointer;">
            <div class="icon-circle-login mb-3 mx-auto bg-primary">
              <i class="fas fa-user"></i>
            </div>
            <h5 class="fw-bold">Usuario</h5>
            <p class="text-muted small">Busco estacionamiento para mi vehículo.</p>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card h-100 text-center p-4 account-type-card" (click)="selectAccountType('garage')"
            style="cursor: pointer;">
            <div class="icon-circle-login mb-3 mx-auto bg-success">
              <i class="fas fa-warehouse"></i>
            </div>
            <h5 class="fw-bold">Cochera</h5>
            <p class="text-muted small">Ofrezco espacios de estacionamiento.</p>
          </div>
        </div>
      </div>

      <div class="text-center mt-4">
        <span class="text-muted small">
          ¿Ya tenés cuenta?
          <a routerLink="/login" class="login-link">Iniciá sesión acá</a>
        </span>
      </div>
    </div>

    <!-- FORMULARIO DE REGISTRO DE USUARIO -->
    <div *ngIf="currentStep === 'registerUser'">
      <div class="d-flex justify-content-between align-items-start mb-4 register-header">
        <div>
          <h2 class="section-title mb-1">Registro de usuario</h2>
          <p class="text-muted small mb-0">
            Completá tus datos para crear tu cuenta.
          </p>
        </div>
        <button class="btn btn-outline-dark btn-sm back-pill" (click)="backToSelection()">
          <i class="fas fa-arrow-left me-1"></i>
          Volver
        </button>
      </div>

      <form (ngSubmit)="registerUser()" #userForm="ngForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="dni" class="form-label">DNI *</label>
            <input type="text" id="dni" class="form-control modern-input" name="dni" [(ngModel)]="userData.dni"
              required [class.is-invalid]="fieldErrors['dni']">
            <div *ngIf="fieldErrors['dni']" class="invalid-feedback d-block">{{ fieldErrors['dni'] }}</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">Nombre *</label>
            <input type="text" id="name" class="form-control modern-input" name="name" [(ngModel)]="userData.name"
              required [class.is-invalid]="fieldErrors['name']">
            <div *ngIf="fieldErrors['name']" class="invalid-feedback d-block">{{ fieldErrors['name'] }}</div>
          </div>
        </div>

        <div class="mb-3">
          <label for="lastname" class="form-label">Apellido *</label>
          <input type="text" id="lastname" class="form-control modern-input" name="lastname"
            [(ngModel)]="userData.lastname" required [class.is-invalid]="fieldErrors['lastname']">
          <div *ngIf="fieldErrors['lastname']" class="invalid-feedback d-block">{{ fieldErrors['lastname'] }}</div>
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email *</label>
          <input type="email" id="email" class="form-control modern-input" name="email" [(ngModel)]="userData.email"
            required [class.is-invalid]="fieldErrors['email']">
          <div *ngIf="fieldErrors['email']" class="invalid-feedback d-block">{{ fieldErrors['email'] }}</div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="phoneNumber" class="form-label">Teléfono *</label>
            <input type="tel" id="phoneNumber" class="form-control modern-input" name="phoneNumber"
              [(ngModel)]="userData.phoneNumber" required [class.is-invalid]="fieldErrors['phoneNumber']">
            <div *ngIf="fieldErrors['phoneNumber']" class="invalid-feedback d-block">{{ fieldErrors['phoneNumber'] }}</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="address" class="form-label">Dirección *</label>
            <input type="text" id="address" class="form-control modern-input" name="address"
              [(ngModel)]="userData.address" required [class.is-invalid]="fieldErrors['address']">
            <div *ngIf="fieldErrors['address']" class="invalid-feedback d-block">{{ fieldErrors['address'] }}</div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="password" class="form-label">Contraseña *</label>
            <input type="password" id="password" class="form-control modern-input" name="password"
              [(ngModel)]="userData.password" required [class.is-invalid]="fieldErrors['password']">
            <div *ngIf="fieldErrors['password']" class="invalid-feedback d-block">{{ fieldErrors['password'] }}</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="confirmPassword" class="form-label">Confirmar contraseña *</label>
            <input type="password" id="confirmPassword" class="form-control modern-input" name="confirmPassword"
              [(ngModel)]="userData.confirmPassword" required>
          </div>
        </div>

        <button type="submit" class="btn btn-dark-custom w-100 btn-lg mb-3" [disabled]="userForm.invalid || message">
          REGISTRARSE
        </button>
      </form>
    </div>

    <!-- FORMULARIO DE REGISTRO DE COCHERA -->
    <div *ngIf="currentStep === 'registerGarage'">
      <div class="d-flex justify-content-between align-items-start mb-4 register-header">
        <div>
          <h2 class="section-title mb-1">Registro de cochera</h2>
          <p class="text-muted small mb-0">
            Completá los datos de tu cochera para empezar a recibir reservas.
          </p>
        </div>
        <button class="btn btn-outline-dark btn-sm back-pill" (click)="backToSelection()">
          <i class="fas fa-arrow-left me-1"></i>
          Volver
        </button>
      </div>

      <form (ngSubmit)="registerGarage()" #garageForm="ngForm">
        <div class="mb-3">
          <label for="cuit" class="form-label">CUIT *</label>
          <input type="text" id="cuit" class="form-control modern-input" name="cuit" [(ngModel)]="garageData.cuit"
            required [class.is-invalid]="fieldErrors['cuit']">
          <div *ngIf="fieldErrors['cuit']" class="invalid-feedback d-block">{{ fieldErrors['cuit'] }}</div>
        </div>

        <div class="mb-3">
          <label for="garageName" class="form-label">Nombre de la cochera *</label>
          <input type="text" id="garageName" class="form-control modern-input" name="garageName"
            [(ngModel)]="garageData.name" required [class.is-invalid]="fieldErrors['name']">
          <div *ngIf="fieldErrors['name']" class="invalid-feedback d-block">{{ fieldErrors['name'] }}</div>
        </div>

        <div class="mb-3">
          <label for="garageEmail" class="form-label">Email *</label>
          <input type="email" id="garageEmail" class="form-control modern-input" name="garageEmail"
            [(ngModel)]="garageData.email" required [class.is-invalid]="fieldErrors['email']">
          <div *ngIf="fieldErrors['email']" class="invalid-feedback d-block">{{ fieldErrors['email'] }}</div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="garagePhone" class="form-label">Teléfono *</label>
            <input type="tel" id="garagePhone" class="form-control modern-input" name="garagePhone"
              [(ngModel)]="garageData.phoneNumber" required [class.is-invalid]="fieldErrors['phoneNumber']">
            <div *ngIf="fieldErrors['phoneNumber']" class="invalid-feedback d-block">{{ fieldErrors['phoneNumber'] }}</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="garageAddress" class="form-label">Dirección *</label>
            <input type="text" id="garageAddress" class="form-control modern-input" name="garageAddress"
              [(ngModel)]="garageData.address" required [class.is-invalid]="fieldErrors['address']">
            <div *ngIf="fieldErrors['address']" class="invalid-feedback d-block">{{ fieldErrors['address'] }}</div>
          </div>
        </div>

        <div class="mb-3">
          <label for="location" class="form-label">Localidad *</label>
          <select id="location" class="form-control modern-input" name="location" [(ngModel)]="garageData.location"
            required [class.is-invalid]="fieldErrors['location']">
            <option value="">Seleccioná una localidad</option>
            <option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</option>
          </select>
          <div *ngIf="fieldErrors['location']" class="invalid-feedback d-block">{{ fieldErrors['location'] }}</div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="garagePassword" class="form-label">Contraseña *</label>
            <input type="password" id="garagePassword" class="form-control modern-input" name="garagePassword"
              [(ngModel)]="garageData.password" required [class.is-invalid]="fieldErrors['password']">
            <div *ngIf="fieldErrors['password']" class="invalid-feedback d-block">{{ fieldErrors['password'] }}</div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="garageConfirmPassword" class="form-label">Confirmar contraseña *</label>
            <input type="password" id="garageConfirmPassword" class="form-control modern-input"
              name="garageConfirmPassword" [(ngModel)]="garageData.confirmPassword" required>
          </div>
        </div>

        <button type="submit" class="btn btn-dark-custom w-100 btn-lg mb-3" [disabled]="garageForm.invalid || message">
          REGISTRAR COCHERA
        </button>
      </form>
    </div>

  </div>
</div>